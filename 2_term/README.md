Второй семестр
================


Первый модуль
--------------

***A.*** Леон и Матильда собрались пойти в магазин за молоком. Их хочет поймать Стэнсфилд, поэтому нашим товарищам нужно сделать это как можно быстрее. Каково минимальное количество улиц, по которым пройдёт хотя бы один из ребят (либо Матильда, либо Леон, либо оба вместе)?<br/>
**Формат входных данных.** Первая строка содержит количество вершин n (1 ≤ n ≤ 10^5), количество ребер m (0 ≤ m ≤ 10^5) и номера вершин графа leon, matilda, milk, в которых находятся соответственно Леон, Матильда и магазин с молоком. Следующие m строк содержат ребра графа. В каждой строке два числа, разделенные пробелом, если между i и j существует ребро. Гарантируется, что в графе нет петель и мультиребер.<br/>
**Формат выходных данных.** Одно число – количество ребер.

***B.*** Джон Макклейн сообщает по рации новую информацию о террористах в отдел с n полицейскими. Он звонит нескольким сотрудникам и просит распространить информацию по отделу, зная, что у каждого полицейского есть связь с определёнными коллегами. Джон Макклейн хочет, чтобы операция прошла успешно. Но если полицейский позвонит коллеге, от которого(возможно, не напрямую) сам получил информацию, террористы смогут отследить этот звонок и помешать операции. Если же двое сотрудников оповестят одного, ничего плохого не произойдёт. Помогите Джону Макклейну. Выведите NO, если кто-то из полицейских ошибётся, делая звонок. Если всё пройдёт хорошо, выведите YES и порядок, в котором полицейские получат информацию, считая, что полицейские оповещают коллег по возрастанию их номеров, а в начале Джон даёт информацию тем, кому не может позвонить никто из коллег.<br/>
**Формат входных данных.** Первая строка содержит пару целых чисел n и m (1 ≤ n, m ≤ 10^5) — количество вершин и рёбер заданного ориентированного графа. Следующие m строк содержат описания рёбер, по одному в строке. Каждая из строк содержит по два целых числа a и b (0 ≤ a, b < n) — начало и конец ребра.<br/>
**Формат выходных данных.** Если такого порядка не существует, то выведите «NO» (без кавычек).
В противном случае, выведите «YES» в первую из строк. Во вторую строку выведите перестановку индексов вершин (целые числа от 0 до n - 1), такую, что для каждого ребра его стартовая вершина находится строго левее его конечной вершины.

***C.*** Фрэнку опять прилетел новый заказ. Однако в этот раз город играет по очень странным правилам: все дороги в городе односторонние и связывают только офисы нанимателей перевозчика. Множество офисов, между любыми двумя из которых существует путь, образуют квартал, если нельзя добавить никакие другие, чтобы условие выполнялось. Фрэнку интересно, каково минимальное количество односторонних дорог нужно ещё построить, чтобы весь город стал квраталом.<br/>
**Формат входных данных.** Первая строка содержит пару целых чисел n и m (1 ≤ n ≤ 10^5, 0 ≤ m ≤ 10^5) — количество вершин и рёбер заданного ориентированного графа. Следующие m строк содержат описания рёбер, по одному в строке. Каждая из строк содержит по два целых числа a и b (1 ≤ a, b ≤ n) — начало и конец ребра.<br/>
**Формат выходных данных.** Выведите одно число — количество дорог, которые нужно добавить, чтобы весь город стал одним кварталом.


Второй модуль
--------------

***A.*** Рик и Морти снова бороздят просторы вселенных, но решили ограничиться только теми, номера которых меньше M. Они могут телепортироваться из вселенной с номером z во вселенную (z+1) mod M за a бутылок лимонада или во вселенную (z^2+1) mod M за b бутылок лимонада. Рик и Морти хотят добраться из вселенной с номером x во вселенную с номером y. Сколько бутылок лимонада отдаст Рик за такое путешествие, если он хочет потратить их как можно меньше?<br/>
**Формат входных данных.** В строке подряд даны количество бутылок a за первый тип телепортации, количество бутылок b за второй тип телепортации, количество вселенных M, номер стартовой вселенной x, номер конечной вселенной y (0 ≤ a, b ≤ 100, 1 ≤ M ≤ 10^6, 0 ≤ x, y < M).<br/>
**Формат выходных данных.** Выведите одно число — количество бутылок лимонада, которые отдаст Рик за такое путешествие.

***B.*** Рику необходимо попасть на межвселенную конференцию. За каждую телепортацию он платит бутылками лимонада, поэтому хочет потратить их на дорогу как можно меньше (он же всё-таки на конференцию едет!). Однако после K перелетов подряд Рика начинает сильно тошнить, и он ложится спать на день. Ему известны все существующие телепортации. Теперь Рик хочет найти путь (наименьший по стоимости в бутылках лимонада), учитывая, что телепортация не занимает времени, а до конференции осталось 10 минут (то есть он может совершить не более K перелетов)!<br/>
**Формат входных данных.** В первой строке находятся количество вселенных N, количество существующих телепортаций M, количество перелетов подряд K, номер вселенной Рика S, номер вселенной конференции F (2 ≤ N ≤ 300, 1 ≤ M ≤ 10^5, 1 ≤ K ≤ 300, 1 ≤ S ≤ N, 1 ≤ F ≤ N).<br/>
Далее идет M строк, задающих телепортации. i-я строка содержит три натуральных числа: Si, Fi и Pi, где Si - номер вселенной, из которой ведет i-я телепортация, Fi - номер вселенной, в которую ведет i-я телепортация, Pi - стоимость i-й телепортации. 1 ≤ Si ≤ N, 1 ≤ Fi ≤ N, 1 ≤ Pi ≤ 10^6.<br/>
**Формат выходных данных.** Выведите одно число - минимальную стоимость пути, подходящего для профессора. Если профессор не сможет за K ночей добраться до конференции, выведите число -1.

***C.*** Сейчас Рику надо попасть из вселенной с номером S во вселенную с номером F. Он знает все существующие телепорты, и казалось бы нет никакой проблемы. Но, далеко не секрет, что за свою долгую жизнь Рик поссорился много с кем. Из своего личного опыта он знает, что при телепортациях есть вероятность, что его заставят ответить за свои слова.
Если Рик знает вероятности быть прижатым к стенке на всех существующих телепортациях, помогите ему посчитать минимальную вероятность, что он всё-таки столкнется с неприятностями.<br/>
**Формат входных данных.** В первой строке даны количество вселенных N (2 ≤ N ≤ 100), количество существующих телепортаций M (1 ≤ M ≤ N ⋅ (N - 1) / 2), стартовая вселенная S (1 ≤ S ≤ N) и конечная вселенная F (1 ≤ F ≤ N). Далее в M строках дается описание телепортаций в формате Si, Fi, Pi, где Si и Fi — номера вселенных, которые связывает i-я телепортация (телепорты двунаправленные, 1 ≤ Si, Fi ≤ N), Pi — вероятность быть избитым на i-й телепортации в процентах (0 ≤ Pi ≤ 100).<br/>
**Формат выходных данных.** Вероятность быть избитым с точностью до 10^-6.

***D.*** Рик отправляет Морти в путешествие по N вселенным. У него есть список всех существующих однонаправленных телепортов. Чтобы Морти не потерялся, Рику необходимо узнать, между какими вселенными существуют пути, а между какими нет. Помогите ему в этом!<br/>
**Формат входных данных.** На первой строке задано количество вселенных N (1 ≤ N ≤ 1 000). Следующие N строк имеют длину N, состоят из нулей и единиц и задают матрицу смежности вселенных. Единица в i-й строке j-м столбце обозначает телепорт из i-й вселенной в j-ю.<br/>
**Формат выходных данных.** Выведите матрицу, где единица в i-й строке j-м столбце обозначает существование пути из i-й вселенной в j-ю и ноль — его отсутствие.

***E.*** Рик решил на день почувствовать себя бизнесменом! В городе есть несколько обменников валюты. В рамках данной задачи считаем, что каждый обменник специализируется только на двух валютах и может производить операции только с ними. Возможно, существуют обменники, специализирующиеся на одинаковых парах валют. В каждом обменнике — свой обменный курс: курс обмена A на B — это количество единиц валюты B, выдаваемое за 1 единицу валюты A. Также в каждом обменнике есть комиссия — сумма, которую вы должны заплатить, чтобы производить операцию. Комиссия взимается в той валюте, которую меняет клиент.<br/>
Например, если вы хотите поменять 100 долларов США на русские рубли в обменнике, где курс обмена равен 29.75, а комиссия равна 0.39, вы получите (100 - 0.39) ⋅ 29.75 = 2963.3975 рублей (эх, были времена).<br/>
Вы точно знаете, что в городе используется всего N валют. Пронумеруем их числами 1, 2, …, N. Тогда каждый обменник представляют 6 чисел: целые A и B — номера обмениваемых валют, а также вещественные RAB, CAB, RBA и CBA — обменные курсы и комиссии при переводе из A в B и из B в A соответственно.<br/>
Рик обладает некоторой суммой в валюте S. Он задаётся вопросом, можно ли, после нескольких операций обмена увеличить свой капитал. Конечно, он хочет, чтобы в конце его деньги вновь были в валюте S. Помогите ему ответить на его вопрос. Рик должен всегда должен иметь неотрицательную сумму денег. <br/>
**Формат входных данных.** Первая строка содержит четыре числа: N — количество валют, M — количество обменников, S — валюта, которой располагает Рик, и V — количество единиц этой валюты. Следующие M строк содержат по 6 чисел, которые задают описание соответствующих обменников в описанном выше формате. Числа разделяются одним или несколькими пробелами. В каждом обменнике курсы обмена и комиссии — вещественные числа, задаваемые с точностью не выше двух знаков после запятой в десятичном представлении. <br/>
Назовём последовательность операций обмена простой, если каждый обменник используется в ней не более одного раза. Вы можете считать, что отношение итоговой суммы Рика к исходной не будет превосходить 10^4 при любой простой последовательности операций. <br/>
**Формат выходных данных.** Если Рик может увеличить свой капитал, выведите YES, иначе выведите NO.



Третий модуль
--------------
***A.*** Требуется найти в связном графе остовное дерево минимального веса. Воспользуйтесь алгоритмом Прима. <br/>
**Формат входных данных.** Первая строка входного файла содержит два натуральных числа n и m — количество вершин и ребер графа соответственно. Следующие m строк содержат описание ребер по одному на строке. Ребро номер i описывается тремя натуральными числами bi, ei и wi — номера концов ребра и его вес соответственно (1 ≤ bi, ei ≤ n, 0 ≤ wi ≤ 100 000). n ≤ 5 000, m ≤ 100 000.
Граф является связным. <br/>
**Формат выходных данных.** Первая строка выходного файла должна содержать одно натуральное число — вес минимального остовного дерева.

***B.*** Требуется найти в связном графе остовное дерево минимального веса. Воспользуйтесь алгоритмом Крускала.<br/>
**Формат входных данных.** Первая строка входного файла содержит два натуральных числа n и m — количество вершин и ребер графа соответственно. Следующие m строк содержат описание ребер по одному на строке. Ребро номер i описывается тремя натуральными числами bi, ei и wi — номера концов ребра и его вес соответственно (1 ≤ bi, ei ≤ n, 0 ≤ wi ≤ 100 000). n ≤ 20 000, m ≤ 100 000.
Граф является связным. <br/>
**Формат выходных данных.** Первая строка выходного файла должна содержать одно натуральное число — вес минимального остовного дерева.

***C.*** Вам дан неориентированный граф, состоящий из n вершин. На каждой вершине записано число; число, записанное на вершине i, равно ai. Изначально в графе нет ни одного ребра.<br/>
Вы можете добавлять ребра в граф за определенную стоимость. За добавление ребра между вершинами x и y надо заплатить ax + ay монет. Также существует m специальных предложений, каждое из которых характеризуется тремя числами x, y и w, и означает, что можно добавить ребро между вершинами x и y за w монет. Эти специальные предложения не обязательно использовать: если существует такая пара вершин x и y, такая, что для нее существует специальное предложение, можно все равно добавить ребро между ними за ax + ay монет.<br/>
Сколько монет минимально вам потребуется, чтобы сделать граф связным? Граф является связным, если от каждой вершины можно добраться до любой другой вершины, используя только ребра этого графа. <br/>
**Формат входных данных.** В первой строке заданы два целых числа n и m (1 ≤ n ≤ 2 ⋅ 10^5, 0 ≤ m ≤ 2 ⋅ 10^5) — количество вершин в графе и специальных предложений, соответственно.
Во второй строке заданы n целых чисел  (1 ≤ ai ≤ 10^12) — числа, записанные на вершинах.
Затем следуют m строк, в каждой из которых заданы три целых числа x, y и w (1 ≤ x, y ≤ n, 1 ≤ w ≤ 10^12, x ≠ y), обозначающие спецпредложение: можно добавить ребро между вершинами x и y за w монет. <br/>
**Формат выходных данных.** Выведите одно целое число — минимальное количество монет, которое необходимо потратить, чтобы сделать граф связным.


***D.*** Шреку необходимо пробраться в башню, чтобы спасти прекрасную принцессу Фиону. И сейчас его путь лежит через старый полуразвалившийся мост. Осёл очень боится упасть с этого моста в лавовую реку под ним и отказывается идти дальше, пока мост не будет полностью починен. Шрек не может идти без друга и решил отремонтировать его.
Мост представляет собой поле из n × m клеток, причем некоторые клетки ещё остались целыми. У Шрека есть только дощечки размера 1 × 2, установка которых занимает у него a секунд, и 1 × 1, установка которых занимает b секунд. Ему необходимо закрыть все пустые клетки, причем только их, не накладывая дощечки друг на друга.
Определите, через какое минимальное количество секунд Шрек и Осёл смогут продолжить свой путь дальше. <br/>
**Формат входных данных.**  Первая строка входного файла содержит 4 целых числа n, m, a, b (1 ≤ n, m ≤ 100, |a| ≤ 1 000, |b| ≤ 1 000). Каждая из последующих n строк содержит по m символов: символ  «.» (точка) обозначает целую клетку моста, а символ «*» (звёздочка) — пустую. <br/>
**Формат выходных данных.** В выходной файл выведите одно число — минимальное количество секунд, через которое наши герои смогут продолжить свой путь, закрыв пустые клетки моста (их и только их).

***E.*** Шрек и Осёл уже были на пути домой. Им оставалось только преодолеть лес, который отделял их от болота. Но они поссорились, поэтому не хотят идти вместе.<br/>
Лес представляет собой опушки, пронумерованы числами от 1 до n и соединенные m дорожками (может быть несколько дорожек соединяющих две опушки, могут быть дорожки, соединяющие опушку с собой же). Из-за ссоры, если по дорожке прошел один из друзей, то второй по той же дорожке уже идти не может. Сейчас друзья находятся на опушке с номером s, а болото Шрека — на опушке с номером t. Помогите Шреку и Ослу добраться до болота. <br/>
**Формат входных данных.** В первой строке файла записаны четыре целых числа — n, m, s и t (2 ≤ n ≤ 10^5, 0 ≤ m ≤ 10^5, ). В следующих m строках записаны пары чисел. Пара чисел (x, y) означает, что есть дорожка с опушки x до опушки y (из-за особенностей местности дорожки односторонние). <br/>
**Формат выходных данных.** Если существует решение, то выведите YES и на двух отдельных строчках сначала последовательность опушек для Шрека, затем путь для Осла.Если решения не существует, выведите NO. Если решений несколько, выведите любое.

***F.*** Шрек и Фиона пригласили всех своих друзей на свою свадьбу. На церемонии они хотят рассадить их всех на две непустые части так, чтобы количество знакомств между двумя частями было минимальным. Всего приглашенных на свадьбу n, а каждое знакомство обоюдно.
Вам дан граф, в котором ребро означает знакомство между людьми. Помогите Шреку и Фионе поделить гостей на две непустые части. <br/>
**Формат входных данных.**  В первой строке входного файла записано целое число n () — число гостей. Каждая из следующих n строк содержит по n символов. i-й символ j-й из этих строк равен «1», если между вершинами i и j есть ребро, и «0» в противном случае. Заданная таким образом матрица смежности является антирефлексивной (на главной диагонали стоят нули) и симметричной (относительно главной диагонали).<br/>
**Формат выходных данных.** Выведите в выходной файл две строки. На первой выведите номера вершин, попавших в левую часть, через пробел, а на второй — номера вершин, попавших в правую часть, также через пробел. Номера вершин можно выводить в любом порядке.


Четвертый модуль
--------------

***A.*** Дано число N и последовательность из N целых чисел. Найти вторую порядковую статистику на заданных диапазонах.
Для решения задачи используйте структуру данных Sparse Table. Требуемое время обработки каждого диапазона O(1). Время подготовки структуры данных O(NlogN). <br/>
**Формат входных данных.** В первой строке заданы 2 числа: размер последовательности N и количество диапазонов M. Следующие N целых чисел задают последовательность. Далее вводятся M пар чисел - границ диапазонов.
Гарантируется, что каждый диапазон содержит как минимум 2 элемента. <br/>
**Формат выходных данных.** Для каждого из M диапазонов напечатать элемент последовательности - 2ю порядковую статистику. По одному числу в строке.

***B.*** ООО "Новые Железные Дороги" поручило вам разработать систему бронирования билетов на новый маршрут поезда дальнего следования. Маршрут проходит через N станций, занумерованных от 0 до N-1. Вместимость поезда ограничена.
В систему бронирования последовательно приходят запросы от пассажиров с указанием номера начальной и конечной станции, а также количество билетов, которые пассажир хочет приобрести.
Требуемая скорость обработки каждого запроса - O(logN).<br/>
**Формат входных данных.**  Первая строка содержит число N –– количество станций (1 ≤ N ≤ 50 000).
Вторая строка содержит начальное количество проданных билетов.
В примере продано по одному билету на перегонах 0->1 и 4->5.
В третьей строке указана вместимость поезда. В четвёртой — количество запросов на бронирование.
Далее идут непосредственно запросы в виде: номер начальной станции, номер конечной станции, количество запрашиваемых билетов.<br/>
**Формат выходных данных.** Необходимо вывести номера запросов, которые не удалось выполнить из-за отсутствия свободных мест.


***C.*** У художника-авангардиста есть полоска разноцветного холста. За один раз он перекрашивает некоторый отрезок полоски в некоторый цвет. После каждого перекрашивания специально обученный фотограф делает снимок части получившегося творения для музея современного искусства. Для правильного экспонирования требуется знать яркость самого темного цвета на выбранном фотографом отрезке. Напишите программу для определения яркости самого темного цвета на отрезке.<br/>
Требуемая скорость определения яркости — O(log N).<br/>
Цвет задается тремя числами R, G и B (0 ≤ R, G, B ≤ 255), его яркость = R + G + B.<br/>
Цвет (R1, G1, B1) темнее цвета (R2, G2, B2), если R1 + G1 + B1 < R2 + G2 + B2.<br/>
**Формат входных данных.** Первая строка содержит число N –– длина отрезка (координаты [0...N-1]).
Затем следует N строк по 3 числа –– цвета отрезка.
Следующая строка содержит число K –– количество перекрашиваний и фотографирований.
Затем задано K строк, описывающих перекрашивание и фотографирование.
В каждой такой строке 7 натуральных чисел: C, D, R, G, B, E, F, где [C, D] –– координаты перекрашиваемого отрезка, (R, G, B) –– цвет покраски, [E, F] –– фотографируемый отрезок. <br/>
**Формат выходных данных.**. Требуется вывести K целых чисел. Каждое число –– яркость самого темного цвета на отрезке [E, F] после соответствующего окрашивания.

***D.***  Задано дерево с корнем, содержащее (1 ≤ n ≤ 100 000) вершин, пронумерованных от 0 до n-1.
Требуется ответить на m (1 ≤ m ≤ 10 000 000) запросов о наименьшем общем предке для пары вершин.
Запросы генерируются следующим образом. Заданы числа a1, a2 и числа x, y и z. <br/>
**Формат входных данных.** Первая строка содержит два числа: n и m.<br/>
Корень дерева имеет номер 0.<br/>
Вторая строка содержит n-1 целых чисел, i-е из этих чисел равно номеру родителя вершины i.<br/>
Третья строка содержит два целых числа в диапазоне от 0 до n-1: a1 и a2.<br/>
Четвертая строка содержит три целых числа: x, y и z, эти числа неотрицательны и не превосходят 10^9. <br/>
**Формат выходных данных.** Выведите в выходной файл сумму номеров вершин — ответов на все запросы.

***E.*** Реализуйте структуру данных “массив строк” на основе декартового дерева по неявному ключу со следующими методами: 

    // Добавление строки в позицию position. Все последующие строки сдвигаются на одну позицию вперед.
    void InsertAt(int position, const std::string& value);
    // Удаление строки из позиции position. Все последующие строки сдвигаются на одну позицию назад. 
    void DeleteAt(int position);
    // Получение строки из позиции position. 
    std::string GetAt(int position);

Все методы должны работать за O(log n) в среднем, где n – текущее количество строк в массиве. <br/>
**Формат входных данных.**  Первая строка содержит количество команд  k≤10^6.
Последующие k строк содержат описания команд: Команда “+ 10 hello” означает добавление строки hello в позицию 10. Команда “- 14 16” означает удаление строки от позиции 14 до позиции 16. Команда “? 33” означает запрос на вывод строки из массива в позиции 33.<br/>
**Формат выходных данных.** Выведите все строки, запрошенные командами “?”.
